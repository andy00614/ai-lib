# AI Tools Monorepo æ¶æ„è®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£é€šè¿‡å…·ä½“æ¡ˆä¾‹è¯´æ˜AI Toolsé¡¹ç›®çš„Monorepoæ¶æ„è®¾è®¡ï¼Œå±•ç¤ºå„æ¨¡å—ä¹‹é—´çš„ç»„ç»‡å…³ç³»å’Œåä½œæ–¹å¼ã€‚

## ğŸ¯ æ¡ˆä¾‹ï¼šçŸ¥è¯†ç‚¹å¤§çº²ç”ŸæˆåŠŸèƒ½

æˆ‘ä»¬ä»¥"ç”¨æˆ·è¯·æ±‚ç”Ÿæˆæœºå™¨å­¦ä¹ çŸ¥è¯†ç‚¹å¤§çº²"ä¸ºä¾‹ï¼Œå±•ç¤ºå®Œæ•´çš„æ•°æ®æµå’Œæ¨¡å—åä½œè¿‡ç¨‹ã€‚

## ğŸ”„ å®Œæ•´æµç¨‹åºåˆ—å›¾

```mermaid
sequenceDiagram
    participant User as ğŸ‘¤ ç”¨æˆ·
    participant API as ğŸŒ APIæœåŠ¡<br/>(apps/api)
    participant Auth as ğŸ” è®¤è¯ä¸­é—´ä»¶<br/>(apps/api/middleware)
    participant Schema as ğŸ“ å‚æ•°éªŒè¯<br/>(apps/api/schemas)
    participant Generator as ğŸ¤– å¤§çº²ç”Ÿæˆå™¨<br/>(packages/ai/knowledge)
    participant Provider as ğŸ¯ AIæä¾›å•†<br/>(packages/ai/chat/providers)
    participant DB as ğŸ—„ï¸ æ•°æ®åº“æŸ¥è¯¢<br/>(packages/db/queries)
    participant Storage as ğŸ’¾ æ–‡ä»¶å­˜å‚¨<br/>(packages/storage)
    participant Jobs as âš™ï¸ åå°ä»»åŠ¡<br/>(packages/jobs)
    participant Cache as ğŸš€ ç¼“å­˜<br/>(packages/cache)

    Note over User,Cache: ğŸ“š çŸ¥è¯†ç‚¹å¤§çº²ç”Ÿæˆæµç¨‹

    User->>API: POST /api/knowledge/outlines<br/>{ topic: "æœºå™¨å­¦ä¹ ", level: "beginner" }
    
    API->>Auth: éªŒè¯ç”¨æˆ·èº«ä»½
    Auth-->>API: âœ… ç”¨æˆ·å·²è®¤è¯
    
    API->>Schema: éªŒè¯è¯·æ±‚å‚æ•°
    Schema-->>API: âœ… å‚æ•°æ ¼å¼æ­£ç¡®
    
    API->>Cache: æ£€æŸ¥æ˜¯å¦æœ‰ç¼“å­˜
    Cache-->>API: âŒ æ— ç¼“å­˜ï¼Œéœ€è¦ç”Ÿæˆ
    
    API->>Generator: generateOutline(topic, level, userId)
    
    Note over Generator: ğŸ§  AIå¤„ç†é€»è¾‘å¼€å§‹
    
    Generator->>Provider: è°ƒç”¨OpenAI API<br/>prompt: "ç”Ÿæˆæœºå™¨å­¦ä¹ åˆçº§å¤§çº²"
    Provider-->>Generator: è¿”å›AIç”Ÿæˆçš„å¤§çº²æ•°æ®
    
    Generator->>DB: ä¿å­˜ç”Ÿæˆçš„å¤§çº²<br/>saveOutline(data, userId)
    DB-->>Generator: âœ… ä¿å­˜æˆåŠŸï¼Œè¿”å›ID
    
    Generator->>Storage: ä¿å­˜å¤§çº²ä¸ºJSONæ–‡ä»¶<br/>saveFile(outlineId, data)
    Storage-->>Generator: âœ… æ–‡ä»¶å·²ä¿å­˜
    
    Generator->>Jobs: è§¦å‘åå°ä»»åŠ¡<br/>ç”Ÿæˆé…å¥—ç»ƒä¹ é¢˜
    Jobs-->>Generator: âœ… ä»»åŠ¡å·²åŠ å…¥é˜Ÿåˆ—
    
    Generator-->>API: è¿”å›å®Œæ•´å¤§çº²æ•°æ® + ç”ŸæˆID
    
    API->>Cache: ç¼“å­˜ç»“æœï¼ˆ1å°æ—¶ï¼‰
    Cache-->>API: âœ… å·²ç¼“å­˜
    
    API-->>User: è¿”å›JSONæ ¼å¼çš„å¤§çº²<br/>{ id, title, outline, estimatedTime }

    Note over Jobs: âš™ï¸ åå°å¼‚æ­¥å¤„ç†
    Jobs->>Generator: åŸºäºå¤§çº²ç”Ÿæˆç»ƒä¹ é¢˜
    Generator->>Provider: è°ƒç”¨AIç”Ÿæˆé¢˜ç›®
    Provider-->>Generator: è¿”å›é¢˜ç›®æ•°æ®
    Generator->>DB: ä¿å­˜ç»ƒä¹ é¢˜
    DB-->>Generator: âœ… é¢˜ç›®å·²ä¿å­˜
```

## ğŸ—ï¸ æ¨¡å—ç»„ç»‡æ¶æ„å›¾

```mermaid
graph TB
    subgraph "ğŸŒ APIå±‚ (apps/api)"
        A1[è·¯ç”±å±‚<br/>routes/knowledge/outlines.ts]
        A2[ä¸­é—´ä»¶å±‚<br/>middleware/auth.ts]
        A3[éªŒè¯å±‚<br/>schemas/knowledge.ts]
    end

    subgraph "ğŸ¤– ä¸šåŠ¡é€»è¾‘å±‚ (packages/ai)"
        B1[çŸ¥è¯†ç”Ÿæˆå™¨<br/>knowledge/outline-generator.ts]
        B2[AIæä¾›å•†<br/>chat/providers/openai.ts]
        B3[æˆæœ¬è®¡ç®—<br/>shared/cost-calculator.ts]
    end

    subgraph "ğŸ—„ï¸ æ•°æ®å±‚ (packages/db)"
        C1[å¤§çº²æŸ¥è¯¢<br/>queries/knowledge/outlines.ts]
        C2[ç”¨æˆ·æŸ¥è¯¢<br/>queries/users.ts]
        C3[æ•°æ®åº“è¿æ¥<br/>client.ts]
    end

    subgraph "ğŸ“¦ åŸºç¡€è®¾æ–½å±‚"
        D1[æ–‡ä»¶å­˜å‚¨<br/>packages/storage]
        D2[åå°ä»»åŠ¡<br/>packages/jobs]
        D3[ç¼“å­˜æœåŠ¡<br/>packages/cache]
        D4[å·¥å…·å‡½æ•°<br/>packages/utils]
    end

    A1 --> A2
    A2 --> A3
    A3 --> B1
    B1 --> B2
    B1 --> B3
    B1 --> C1
    C1 --> C3
    B1 --> D1
    B1 --> D2
    A1 --> D3
    B1 --> D4

    classDef api fill:#e1f5fe
    classDef business fill:#f3e5f5
    classDef data fill:#e8f5e8
    classDef infra fill:#fff3e0
    
    class A1,A2,A3 api
    class B1,B2,B3 business
    class C1,C2,C3 data
    class D1,D2,D3,D4 infra
```

## ğŸ“ å®Œæ•´æ–‡ä»¶ç³»ç»Ÿç»“æ„

```
ai-tools/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ api/                          # APIæœåŠ¡å™¨
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ knowledge/        # çŸ¥è¯†ç‚¹å¤§çº²ä¸é¢˜ç›®ç”Ÿæˆè·¯ç”±
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ outlines.ts   # å¤§çº²ç”ŸæˆAPI
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ quizzes.ts    # é¢˜ç›®ç”ŸæˆAPI
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ index.ts      # è·¯ç”±æ±‡æ€»
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ chat/             # å¤šæ¨¡å‹é—®ç­”è·¯ç”±
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ models.ts     # æ¨¡å‹åˆ—è¡¨API
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ conversations.ts # å¯¹è¯ç®¡ç†API
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ multi-chat.ts # å¤šæ¨¡å‹å¯¹è¯API
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ index.ts      # è·¯ç”±æ±‡æ€»
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ voice/            # è¯­éŸ³åŠŸèƒ½è·¯ç”±
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ stt.ts        # è¯­éŸ³è½¬æ–‡æœ¬API
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ tts.ts        # æ–‡æœ¬è½¬è¯­éŸ³API
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ index.ts      # è·¯ç”±æ±‡æ€»
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ index.ts          # æ€»è·¯ç”±å…¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts           # è®¤è¯ä¸­é—´ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ validation.ts     # å‚æ•°éªŒè¯ä¸­é—´ä»¶
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ rate-limit.ts     # é™æµä¸­é—´ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ schemas/              # APIè¯·æ±‚/å“åº”éªŒè¯
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ knowledge.ts      # çŸ¥è¯†ç”Ÿæˆç›¸å…³schema
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ chat.ts           # èŠå¤©ç›¸å…³schema
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ voice.ts          # è¯­éŸ³ç›¸å…³schema
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â””â”€â”€ dashboard/                    # å‰ç«¯ç•Œé¢ï¼ˆåç»­ï¼‰
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ db/                          # æ•°æ®åº“å±‚
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ schema.ts            # æ•°æ®åº“è¡¨ç»“æ„
â”‚   â”‚   â”‚   â”œâ”€â”€ client.ts            # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â”‚   â”œâ”€â”€ queries/             # æŒ‰åŠŸèƒ½åˆ†ç±»çš„æŸ¥è¯¢
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ knowledge/       # çŸ¥è¯†ç›¸å…³æŸ¥è¯¢
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ outlines.ts  # å¤§çº²å­˜å‚¨æŸ¥è¯¢
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ quizzes.ts   # é¢˜ç›®å­˜å‚¨æŸ¥è¯¢
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ conversations/   # å¯¹è¯ç›¸å…³æŸ¥è¯¢
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ messages.ts  # æ¶ˆæ¯æŸ¥è¯¢
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ multi-responses.ts # å¤šæ¨¡å‹å“åº”æŸ¥è¯¢
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ voice/           # è¯­éŸ³ç›¸å…³æŸ¥è¯¢
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ audio-files.ts # éŸ³é¢‘æ–‡ä»¶æŸ¥è¯¢
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ transcriptions.ts # è½¬å½•è®°å½•æŸ¥è¯¢
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ users.ts         # ç”¨æˆ·ç›¸å…³æŸ¥è¯¢
â”‚   â”‚   â”‚   â””â”€â”€ migrations/          # æ•°æ®åº“è¿ç§»æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”œâ”€â”€ ai/                          # AIæ ¸å¿ƒåŠŸèƒ½åŒ…
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ knowledge/           # çŸ¥è¯†ç”Ÿæˆæ¨¡å—
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ outline-generator.ts  # å¤§çº²ç”Ÿæˆå™¨
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ quiz-generator.ts     # é¢˜ç›®ç”Ÿæˆå™¨
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ templates.ts          # æç¤ºè¯æ¨¡æ¿
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ types.ts              # ç±»å‹å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ chat/                # å¤šæ¨¡å‹èŠå¤©æ¨¡å—
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ multi-model.ts   # å¤šæ¨¡å‹è°ƒç”¨orchestrator
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ providers/       # AIæä¾›å•†é€‚é…å™¨
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ openai.ts    # OpenAIé€‚é…å™¨
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ claude.ts    # Claudeé€‚é…å™¨
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ gemini.ts    # Geminié€‚é…å™¨
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ index.ts     # æä¾›å•†ç»Ÿä¸€å¯¼å‡º
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ streaming.ts     # æµå¼å“åº”å¤„ç†
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ types.ts         # ç±»å‹å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ voice/               # è¯­éŸ³å¤„ç†æ¨¡å—
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ stt/             # è¯­éŸ³è½¬æ–‡æœ¬
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ whisper.ts   # Whisperé›†æˆ
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ processor.ts # éŸ³é¢‘é¢„å¤„ç†
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ types.ts     # STTç±»å‹å®šä¹‰
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ tts/             # æ–‡æœ¬è½¬è¯­éŸ³
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ elevenlabs.ts # ElevenLabsé›†æˆ
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ azure.ts     # Azure Speeché›†æˆ
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ synthesizer.ts # è¯­éŸ³åˆæˆå™¨
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ types.ts     # TTSç±»å‹å®šä¹‰
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ formats/         # éŸ³é¢‘æ ¼å¼å¤„ç†
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ converter.ts # æ ¼å¼è½¬æ¢
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ validator.ts # æ ¼å¼éªŒè¯
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ types.ts         # è¯­éŸ³æ¨¡å—æ€»ç±»å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ shared/              # å…±äº«åŠŸèƒ½
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ streaming.ts     # é€šç”¨æµå¼å¤„ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ cost-calculator.ts # æˆæœ¬è®¡ç®—
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ rate-limiter.ts  # APIé™æµ
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ utils.ts         # å·¥å…·å‡½æ•°
â”‚   â”‚   â”‚   â””â”€â”€ index.ts             # ç»Ÿä¸€å¯¼å‡º
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”œâ”€â”€ jobs/                        # åå°ä»»åŠ¡å¤„ç†
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ tasks/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ knowledge/       # çŸ¥è¯†ç”Ÿæˆä»»åŠ¡
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ batch-outline.ts # æ‰¹é‡å¤§çº²ç”Ÿæˆ
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ batch-quiz.ts    # æ‰¹é‡é¢˜ç›®ç”Ÿæˆ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ voice/           # è¯­éŸ³å¤„ç†ä»»åŠ¡
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ audio-processing.ts # éŸ³é¢‘å¤„ç†ä»»åŠ¡
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ batch-tts.ts     # æ‰¹é‡è¯­éŸ³åˆæˆ
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ cleanup/         # æ¸…ç†ä»»åŠ¡
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ temp-files.ts    # ä¸´æ—¶æ–‡ä»¶æ¸…ç†
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ old-records.ts   # æ—§è®°å½•æ¸…ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ queues/              # ä»»åŠ¡é˜Ÿåˆ—ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ workers/             # å·¥ä½œè¿›ç¨‹
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”œâ”€â”€ storage/                     # æ–‡ä»¶å­˜å‚¨æŠ½è±¡
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ providers/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ local.ts         # æœ¬åœ°å­˜å‚¨
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ s3.ts            # AWS S3å­˜å‚¨
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ supabase.ts      # Supabaseå­˜å‚¨
â”‚   â”‚   â”‚   â”œâ”€â”€ audio/               # éŸ³é¢‘æ–‡ä»¶ç®¡ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ uploader.ts      # éŸ³é¢‘ä¸Šä¼ 
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ processor.ts     # éŸ³é¢‘å¤„ç†
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ cleanup.ts       # éŸ³é¢‘æ¸…ç†
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”œâ”€â”€ ui/                          # å…±äº«UIç»„ä»¶ï¼ˆå‰ç«¯ç”¨ï¼‰
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ knowledge/       # çŸ¥è¯†ç”Ÿæˆç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ chat/            # èŠå¤©ç•Œé¢ç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ voice/           # è¯­éŸ³ç•Œé¢ç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ shared/          # å…±äº«åŸºç¡€ç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ hooks/               # React Hooks
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”œâ”€â”€ utils/                       # å…±äº«å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ cache/                       # ç¼“å­˜æŠ½è±¡å±‚
â”‚   â””â”€â”€ supabase/                    # è®¤è¯ä¸å®æ—¶åŠŸèƒ½
â””â”€â”€ docs/                            # é¡¹ç›®æ–‡æ¡£
    â”œâ”€â”€ api/                         # APIæ–‡æ¡£
    â”‚   â”œâ”€â”€ knowledge.md             # çŸ¥è¯†ç”ŸæˆAPIæ–‡æ¡£
    â”‚   â”œâ”€â”€ chat.md                  # èŠå¤©APIæ–‡æ¡£
    â”‚   â””â”€â”€ voice.md                 # è¯­éŸ³APIæ–‡æ¡£
    â”œâ”€â”€ deployment/                  # éƒ¨ç½²æ–‡æ¡£
    â””â”€â”€ examples/                    # ä½¿ç”¨ç¤ºä¾‹
```

## ğŸ¯ åˆ†æ¨¡å—çš„æ ¸å¿ƒæ„ä¹‰

### 1. èŒè´£åˆ†ç¦» (Separation of Concerns)

| å±‚æ¬¡ | èŒè´£ | ç¤ºä¾‹æ–‡ä»¶ |
|------|------|----------|
| ğŸŒ **APIå±‚** | HTTPè¯·æ±‚å¤„ç†ã€å‚æ•°éªŒè¯ã€å“åº”æ ¼å¼åŒ– | `apps/api/routes/knowledge/outlines.ts` |
| ğŸ¤– **ä¸šåŠ¡é€»è¾‘å±‚** | æ ¸å¿ƒç®—æ³•ã€AIè°ƒç”¨ã€ä¸šåŠ¡è§„åˆ™ | `packages/ai/knowledge/outline-generator.ts` |
| ğŸ—„ï¸ **æ•°æ®å±‚** | æ•°æ®å­˜å‚¨ã€æŸ¥è¯¢ã€æŒä¹…åŒ– | `packages/db/queries/knowledge/outlines.ts` |
| ğŸ“¦ **åŸºç¡€è®¾æ–½å±‚** | é€šç”¨æœåŠ¡ï¼ˆç¼“å­˜ã€æ–‡ä»¶ã€é˜Ÿåˆ—ç­‰ï¼‰ | `packages/cache/`, `packages/storage/` |

### 2. å¯å¤ç”¨æ€§ (Reusability)

```
âœ… packages/ai/knowledge/ â†’ å¤§çº²ç”Ÿæˆå™¨å¯ä»¥è¢«å¤šä¸ªAPIç«¯ç‚¹å¤ç”¨
âœ… packages/db/queries/   â†’ æ•°æ®æŸ¥è¯¢å¯ä»¥è¢«APIå’Œåå°ä»»åŠ¡å¤ç”¨  
âœ… packages/cache/        â†’ ç¼“å­˜æœåŠ¡å¯ä»¥è¢«æ‰€æœ‰æ¨¡å—å¤ç”¨
âœ… packages/storage/      â†’ æ–‡ä»¶å­˜å‚¨å¯ä»¥è¢«è¯­éŸ³ã€çŸ¥è¯†ç­‰åŠŸèƒ½å¤ç”¨
```

### 3. ç‹¬ç«‹éƒ¨ç½²å’Œæ‰©å±•

```
ğŸš€ apps/api/              â†’ å¯ä»¥ç‹¬ç«‹éƒ¨ç½²ä¸ºAPIæœåŠ¡å™¨
ğŸš€ packages/jobs/         â†’ å¯ä»¥ç‹¬ç«‹éƒ¨ç½²ä¸ºåå°ä»»åŠ¡å¤„ç†å™¨
ğŸš€ packages/ai/knowledge/ â†’ å¯ä»¥ä½œä¸ºå¾®æœåŠ¡ç‹¬ç«‹éƒ¨ç½²
ğŸš€ packages/voice/        â†’ å¯ä»¥å•ç‹¬éƒ¨ç½²ä¸ºè¯­éŸ³å¤„ç†æœåŠ¡
```

### 4. å¼€å‘åä½œ

```
ğŸ‘¥ å›¢é˜ŸA â†’ ä¸“é—¨è´Ÿè´£ packages/ai/ çš„AIç®—æ³•ä¼˜åŒ–
ğŸ‘¥ å›¢é˜ŸB â†’ ä¸“é—¨è´Ÿè´£ apps/api/ çš„æ¥å£å¼€å‘  
ğŸ‘¥ å›¢é˜ŸC â†’ ä¸“é—¨è´Ÿè´£ packages/db/ çš„æ•°æ®åº“è®¾è®¡
ğŸ‘¥ å›¢é˜ŸD â†’ ä¸“é—¨è´Ÿè´£ packages/ui/ çš„å‰ç«¯ç»„ä»¶
```

### 5. æµ‹è¯•éš”ç¦»

```
ğŸ§ª packages/ai/knowledge/ â†’ å¯ä»¥ç‹¬ç«‹è¿›è¡Œå•å…ƒæµ‹è¯•
ğŸ§ª packages/db/queries/   â†’ å¯ä»¥ç”¨æµ‹è¯•æ•°æ®åº“è¿›è¡Œé›†æˆæµ‹è¯•
ğŸ§ª apps/api/routes/       â†’ å¯ä»¥mockä¾èµ–è¿›è¡Œæ¥å£æµ‹è¯•
ğŸ§ª packages/voice/        â†’ å¯ä»¥ç”¨æµ‹è¯•éŸ³é¢‘è¿›è¡ŒåŠŸèƒ½æµ‹è¯•
```

## ğŸ’¡ å®é™…å¼€å‘å·¥ä½œæµç¨‹

å½“ä½ å¼€å‘"çŸ¥è¯†ç‚¹å¤§çº²ç”Ÿæˆ"åŠŸèƒ½æ—¶çš„æ­¥éª¤ï¼š

### ç¬¬ä¸€æ­¥ï¼šæ•°æ®ç»“æ„è®¾è®¡
```bash
ğŸ“ ç¼–è¾‘ packages/db/schema.ts
   â””â”€â”€ å®šä¹‰ outlines è¡¨ç»“æ„
```

### ç¬¬äºŒæ­¥ï¼šæ•°æ®æŸ¥è¯¢å®ç°
```bash
ğŸ“ ç¼–è¾‘ packages/db/queries/knowledge/outlines.ts
   â”œâ”€â”€ createOutline() - åˆ›å»ºå¤§çº²
   â”œâ”€â”€ getOutlineById() - è·å–å¤§çº²
   â””â”€â”€ getUserOutlines() - è·å–ç”¨æˆ·çš„æ‰€æœ‰å¤§çº²
```

### ç¬¬ä¸‰æ­¥ï¼šæ ¸å¿ƒç®—æ³•å¼€å‘
```bash
ğŸ“ ç¼–è¾‘ packages/ai/knowledge/outline-generator.ts
   â”œâ”€â”€ generateOutline() - æ ¸å¿ƒç”Ÿæˆé€»è¾‘
   â”œâ”€â”€ formatOutlineData() - æ•°æ®æ ¼å¼åŒ–
   â””â”€â”€ validateOutline() - ç»“æœéªŒè¯
```

### ç¬¬å››æ­¥ï¼šAPIç«¯ç‚¹åˆ›å»º
```bash
ğŸ“ ç¼–è¾‘ apps/api/routes/knowledge/outlines.ts
   â”œâ”€â”€ POST /outlines - åˆ›å»ºå¤§çº²
   â”œâ”€â”€ GET /outlines/:id - è·å–å¤§çº²
   â””â”€â”€ GET /outlines - è·å–ç”¨æˆ·å¤§çº²åˆ—è¡¨
```

### ç¬¬äº”æ­¥ï¼šåå°ä»»åŠ¡æ·»åŠ 
```bash
ğŸ“ ç¼–è¾‘ packages/jobs/tasks/knowledge/batch-outline.ts
   â””â”€â”€ æ‰¹é‡å¤„ç†å¤§çº²ç”Ÿæˆä»»åŠ¡
```

## ğŸš€ æ¨¡å—é—´é€šä¿¡ç¤ºä¾‹

### å…¸å‹çš„å¯¼å…¥å…³ç³»ï¼š

```typescript
// apps/api/routes/knowledge/outlines.ts
import { generateOutline } from '@ai-tools/ai/knowledge';
import { createOutline, getOutlineById } from '@ai-tools/db/queries';
import { cache } from '@ai-tools/cache';

// packages/ai/knowledge/outline-generator.ts  
import { callOpenAI } from '@ai-tools/ai/chat/providers';
import { calculateCost } from '@ai-tools/ai/shared';
import { uploadFile } from '@ai-tools/storage';

// packages/jobs/tasks/knowledge/batch-outline.ts
import { generateOutline } from '@ai-tools/ai/knowledge';
import { getUserOutlines } from '@ai-tools/db/queries';
```

## ğŸ“ˆ æ¶æ„ä¼˜åŠ¿æ€»ç»“

| ä¼˜åŠ¿ | è¯´æ˜ | å®é™…æ•ˆæœ |
|------|------|----------|
| ğŸ”§ **ä¸“æ³¨å¼€å‘** | æ¯æ¬¡åªéœ€è¦å…³æ³¨ä¸€ä¸ªæ¨¡å— | é™ä½è®¤çŸ¥è´Ÿæ‹…ï¼Œæé«˜å¼€å‘æ•ˆç‡ |
| ğŸš€ **å¿«é€Ÿè¿­ä»£** | ä¿®æ”¹ä¸€ä¸ªåŠŸèƒ½ä¸å½±å“å…¶ä»–æ¨¡å— | å‡å°‘å›å½’æµ‹è¯•ï¼ŒåŠ å¿«å‘å¸ƒé€Ÿåº¦ |
| ğŸ”„ **ä»£ç å¤ç”¨** | ä¸€æ¬¡ç¼–å†™ï¼Œå¤šå¤„ä½¿ç”¨ | å‡å°‘é‡å¤ä»£ç ï¼Œæé«˜ç»´æŠ¤æ€§ |
| ğŸ‘¥ **å›¢é˜Ÿåä½œ** | ä¸åŒäººå‘˜å¯ä»¥å¹¶è¡Œå¼€å‘ä¸åŒæ¨¡å— | æé«˜å›¢é˜Ÿæ•ˆç‡ï¼Œå‡å°‘å†²çª |
| ğŸ§ª **æµ‹è¯•å‹å¥½** | å„æ¨¡å—å¯ä»¥ç‹¬ç«‹æµ‹è¯• | æé«˜æµ‹è¯•è¦†ç›–ç‡ï¼Œä¾¿äºè°ƒè¯• |
| ğŸ“¦ **ç‹¬ç«‹éƒ¨ç½²** | æ¨¡å—å¯ä»¥æ ¹æ®éœ€è¦ç‹¬ç«‹éƒ¨ç½² | æé«˜ç³»ç»Ÿå¯æ‰©å±•æ€§å’Œå®¹é”™æ€§ |

## ğŸ­ æ€»ç»“

è¿™ç§Monorepoæ¶æ„è®©ä½ å¯ä»¥ï¼š

- **ä»å°åšèµ·** â†’ å…ˆå®ç°ä¸€ä¸ªåŠŸèƒ½çš„åŸºç¡€ç‰ˆæœ¬
- **é€æ­¥æ‰©å±•** â†’ åœ¨ç¨³å®šçš„åŸºç¡€ä¸Šæ·»åŠ æ–°åŠŸèƒ½
- **å›¢é˜Ÿåä½œ** â†’ å¤šäººå¯ä»¥åŒæ—¶å¼€å‘ä¸åŒæ¨¡å—
- **ç‹¬ç«‹æµ‹è¯•** â†’ æ¯ä¸ªæ¨¡å—éƒ½å¯ä»¥å•ç‹¬éªŒè¯
- **çµæ´»éƒ¨ç½²** â†’ æ ¹æ®éœ€è¦é€‰æ‹©éƒ¨ç½²ç­–ç•¥

è®°ä½ï¼š**æ¶æ„çš„æ ¸å¿ƒä¸æ˜¯å¤æ‚ï¼Œè€Œæ˜¯æ¸…æ™°ï¼**æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰æ˜ç¡®çš„èŒè´£ï¼Œæ¯ä¸ªæ¨¡å—éƒ½æœ‰æ¸…æ™°çš„è¾¹ç•Œï¼Œè¿™æ ·æ‰èƒ½è®©é¡¹ç›®é•¿æœŸå¥åº·å‘å±•ã€‚